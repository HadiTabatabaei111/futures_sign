<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ“Š Ø¢Ù…Ø§Ø± Ø¯Ù‚Øª Ø³ÛŒÚ¯Ù†Ø§Ù„â€ŒÙ‡Ø§</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.socket.io/4.5.4/socket.io.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Vazirmatn:wght@400;700&display=swap" rel="stylesheet">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Vazirmatn', sans-serif;
            background: linear-gradient(135deg, #0a0a1a 0%, #1a1a3e 100%);
            color: #fff;
            min-height: 100vh;
            padding: 20px;
        }
        .container { max-width: 1600px; margin: 0 auto; }
        
        /* Header */
        .header {
            background: rgba(255,255,255,0.05);
            border-radius: 20px;
            padding: 25px;
            margin-bottom: 25px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .header h1 { font-size: 28px; }
        .header-stats { display: flex; gap: 30px; }
        .header-stat {
            text-align: center;
            padding: 15px 25px;
            background: rgba(255,255,255,0.1);
            border-radius: 15px;
        }
        .header-stat .value { font-size: 36px; font-weight: bold; }
        .header-stat .label { font-size: 14px; color: #888; }
        .header-stat.success .value { color: #00ff88; }
        .header-stat.failure .value { color: #ff4444; }
        
        /* Navigation */
        .nav {
            margin-bottom: 25px;
        }
        .nav a {
            color: #fff;
            text-decoration: none;
            padding: 12px 25px;
            background: rgba(255,255,255,0.1);
            border-radius: 10px;
            margin-left: 10px;
        }
        .nav a:hover { background: rgba(255,255,255,0.2); }
        
        /* Grid */
        .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(400px, 1fr)); gap: 25px; }
        
        /* Card */
        .card {
            background: rgba(255,255,255,0.05);
            border-radius: 20px;
            padding: 25px;
            border: 1px solid rgba(255,255,255,0.1);
        }
        .card h3 {
            margin-bottom: 20px;
            font-size: 18px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        /* Stats Grid */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
        }
        .stat-box {
            background: rgba(255,255,255,0.05);
            padding: 20px;
            border-radius: 15px;
            text-align: center;
        }
        .stat-box .number { font-size: 28px; font-weight: bold; }
        .stat-box .label { font-size: 12px; color: #888; margin-top: 5px; }
        .stat-box.success .number { color: #00ff88; }
        .stat-box.failure .number { color: #ff4444; }
        .stat-box.warning .number { color: #ffa500; }
        
        /* Progress Bar */
        .progress-container {
            margin: 20px 0;
        }
        .progress-bar {
            height: 30px;
            background: rgba(255,255,255,0.1);
            border-radius: 15px;
            overflow: hidden;
            display: flex;
        }
        .progress-success {
            background: linear-gradient(90deg, #00ff88, #00cc6a);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            transition: width 0.5s;
        }
        .progress-failure {
            background: linear-gradient(90deg, #ff4444, #cc0000);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            transition: width 0.5s;
        }
        .progress-pending {
            background: rgba(255,255,255,0.2);
            flex: 1;
        }
        
        /* Table */
        .table-container {
            max-height: 400px;
            overflow-y: auto;
        }
        table {
            width: 100%;
            border-collapse: collapse;
        }
        th, td {
            padding: 12px 15px;
            text-align: right;
            border-bottom: 1px solid rgba(255,255,255,0.05);
        }
        th {
            background: rgba(255,255,255,0.1);
            font-weight: bold;
            position: sticky;
            top: 0;
        }
        tr:hover { background: rgba(255,255,255,0.05); }
        
        /* Status Badge */
        .badge {
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
        }
        .badge.success { background: rgba(0,255,136,0.2); color: #00ff88; }
        .badge.failure { background: rgba(255,68,68,0.2); color: #ff4444; }
        .badge.pending { background: rgba(255,165,0,0.2); color: #ffa500; }
        .badge.buy { background: rgba(0,255,136,0.2); color: #00ff88; }
        .badge.sell { background: rgba(255,68,68,0.2); color: #ff4444; }
        
        /* Chart */
        .chart-container {
            position: relative;
            height: 300px;
        }
        
        /* Source Stats */
        .source-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }
        .source-item {
            background: rgba(255,255,255,0.05);
            padding: 15px;
            border-radius: 12px;
            text-align: center;
        }
        .source-item .name { font-size: 14px; color: #888; margin-bottom: 10px; }
        .source-item .rate { font-size: 24px; font-weight: bold; }
        
        /* Ranking */
        .ranking-item {
            display: flex;
            align-items: center;
            padding: 12px;
            border-bottom: 1px solid rgba(255,255,255,0.05);
        }
        .ranking-item:hover { background: rgba(255,255,255,0.05); }
        .rank-number {
            width: 30px;
            height: 30px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            margin-left: 15px;
        }
        .rank-number.gold { background: linear-gradient(135deg, #f5af19 0%, #f12711 100%); }
        .rank-number.silver { background: linear-gradient(135deg, #bdc3c7 0%, #2c3e50 100%); }
        .rank-number.bronze { background: linear-gradient(135deg, #b8860b 0%, #8b4513 100%); }
        .rank-info { flex: 1; }
        .rank-info .symbol { font-weight: bold; font-size: 16px; }
        .rank-info .stats { font-size: 12px; color: #888; }
        .rank-rate { font-size: 20px; font-weight: bold; }
        
        /* Refresh Timer */
        .refresh-timer {
            position: fixed;
            bottom: 20px;
            left: 20px;
            background: rgba(0,0,0,0.8);
            padding: 10px 20px;
            border-radius: 10px;
            font-size: 14px;
        }
        
        /* Scrollbar */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: rgba(255,255,255,0.05); }
        ::-webkit-scrollbar-thumb { background: rgba(255,255,255,0.2); border-radius: 4px; }
    </style>
</head>
<body>
    <div class="container">
        <!-- Navigation -->
        <div class="nav">
            <a href="/">ğŸ  ØµÙØ­Ù‡ Ø§ØµÙ„ÛŒ</a>
            <a href="/analytics">ğŸ“Š Ø¢Ù…Ø§Ø± Ø¯Ù‚Øª</a>
        </div>
        
        <!-- Header -->
        <div class="header">
            <h1>ğŸ“Š Ø¢Ù…Ø§Ø± Ø¯Ù‚Øª Ø³ÛŒÚ¯Ù†Ø§Ù„â€ŒÙ‡Ø§</h1>
            <div class="header-stats">
                <div class="header-stat success">
                    <div class="value" id="totalSuccess">0%</div>
                    <div class="label">Ù†Ø±Ø® Ù…ÙˆÙÙ‚ÛŒØª Ú©Ù„</div>
                </div>
                <div class="header-stat">
                    <div class="value" id="totalSignals">0</div>
                    <div class="label">Ú©Ù„ Ø³ÛŒÚ¯Ù†Ø§Ù„â€ŒÙ‡Ø§</div>
                </div>
                <div class="header-stat failure">
                    <div class="value" id="totalFailure">0%</div>
                    <div class="label">Ù†Ø±Ø® Ø®Ø·Ø§</div>
                </div>
            </div>
        </div>
        
        <!-- Main Grid -->
        <div class="grid">
            <!-- Overall Stats -->
            <div class="card">
                <h3>ğŸ“ˆ Ø¢Ù…Ø§Ø± Ú©Ù„ÛŒ (24 Ø³Ø§Ø¹Øª Ø§Ø®ÛŒØ±)</h3>
                <div class="stats-grid">
                    <div class="stat-box success">
                        <div class="number" id="stat24hSuccess">0</div>
                        <div class="label">Ø³ÛŒÚ¯Ù†Ø§Ù„ Ù…ÙˆÙÙ‚</div>
                    </div>
                    <div class="stat-box failure">
                        <div class="number" id="stat24hFailed">0</div>
                        <div class="label">Ø³ÛŒÚ¯Ù†Ø§Ù„ Ù†Ø§Ù…ÙˆÙÙ‚</div>
                    </div>
                    <div class="stat-box warning">
                        <div class="number" id="stat24hPending">0</div>
                        <div class="label">Ø¯Ø± Ø§Ù†ØªØ¸Ø§Ø±</div>
                    </div>
                </div>
                
                <div class="progress-container">
                    <div class="progress-bar">
                        <div class="progress-success" id="progressSuccess" style="width: 0%">0%</div>
                        <div class="progress-failure" id="progressFailure" style="width: 0%">0%</div>
                        <div class="progress-pending"></div>
                    </div>
                </div>
                
                <div class="source-stats">
                    <div class="source-item">
                        <div class="name">MA Cross</div>
                        <div class="rate" id="maRate">0%</div>
                    </div>
                    <div class="source-item">
                        <div class="name">EMA Cross</div>
                        <div class="rate" id="emaRate">0%</div>
                    </div>
                    <div class="source-item">
                        <div class="name">UT Bot</div>
                        <div class="rate" id="utRate">0%</div>
                    </div>
                    <div class="source-item">
                        <div class="name">Ø®Ø±ÛŒØ¯</div>
                        <div class="rate success" id="buyRate">0%</div>
                    </div>
                    <div class="source-item">
                        <div class="name">ÙØ±ÙˆØ´</div>
                        <div class="rate" id="sellRate">0%</div>
                    </div>
                </div>
            </div>
            
            <!-- Time Comparison -->
            <div class="card">
                <h3>â±ï¸ Ù…Ù‚Ø§ÛŒØ³Ù‡ Ø²Ù…Ø§Ù†ÛŒ</h3>
                <div class="chart-container">
                    <canvas id="timeChart"></canvas>
                </div>
            </div>
            
            <!-- Top Symbols -->
            <div class="card">
                <h3>ğŸ† Ø¨Ù‡ØªØ±ÛŒÙ† Ø§Ø±Ø²Ù‡Ø§ (Ø¨ÛŒØ´ØªØ±ÛŒÙ† Ù…ÙˆÙÙ‚ÛŒØª)</h3>
                <div id="topRankings"></div>
            </div>
            
            <!-- Recent Signals -->
            <div class="card">
                <h3>ğŸ“‹ Ø³ÛŒÚ¯Ù†Ø§Ù„â€ŒÙ‡Ø§ÛŒ Ø§Ø®ÛŒØ±</h3>
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>Ù†Ù…Ø§Ø¯</th>
                                <th>Ù†ÙˆØ¹</th>
                                <th>Ù‚ÛŒÙ…Øª ÙˆØ±ÙˆØ¯</th>
                                <th>Ù‚ÛŒÙ…Øª Ø®Ø±ÙˆØ¬</th>
                                <th>Ø³ÙˆØ¯/Ø¶Ø±Ø±</th>
                                <th>Ù†ØªÛŒØ¬Ù‡</th>
                                <th>Ø²Ù…Ø§Ù†</th>
                            </tr>
                        </thead>
                        <tbody id="signalHistory"></tbody>
                    </table>
                </div>
            </div>
            
            <!-- Pump/Dump History -->
            <div class="card">
                <h3>ğŸš€ ØªØ§Ø±ÛŒØ®Ú†Ù‡ Ù¾Ø§Ù…Ù¾ Ùˆ Ø¯Ø§Ù…Ù¾</h3>
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>Ù†Ù…Ø§Ø¯</th>
                                <th>Ù†ÙˆØ¹</th>
                                <th>ØªØºÛŒÛŒØ± Ù‚ÛŒÙ…Øª</th>
                                <th>Ø§Ø¯Ø§Ù…Ù‡ Ø±ÙˆÙ†Ø¯ØŸ</th>
                                <th>Ù†ØªÛŒØ¬Ù‡</th>
                                <th>Ø²Ù…Ø§Ù†</th>
                            </tr>
                        </thead>
                        <tbody id="pumpDumpHistory"></tbody>
                    </table>
                </div>
            </div>
            
            <!-- Source Comparison Chart -->
            <div class="card">
                <h3>ğŸ“Š Ù…Ù‚Ø§ÛŒØ³Ù‡ Ù…Ù†Ø§Ø¨Ø¹ Ø³ÛŒÚ¯Ù†Ø§Ù„</h3>
                <div class="chart-container">
                    <canvas id="sourceChart"></canvas>
                </div>
            </div>
        </div>
    </div>
    
    <div class="refresh-timer">
        ğŸ”„ Ø¨Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø¨Ø¹Ø¯ÛŒ: <span id="refreshTimer">180</span> Ø«Ø§Ù†ÛŒÙ‡
    </div>
    
    <script>
        const socket = io();
        let timeChart = null;
        let sourceChart = null;
        let refreshCountdown = 180;
        
        // Ø¨Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ ØªØ§ÛŒÙ…Ø±
        setInterval(() => {
            refreshCountdown--;
            if (refreshCountdown <= 0) refreshCountdown = 180;
            document.getElementById('refreshTimer').textContent = refreshCountdown;
        }, 1000);
        
        // Ø¯Ø±ÛŒØ§ÙØª Ø¢Ù…Ø§Ø±
        async function fetchStats() {
            try {
                const response = await fetch('/api/accuracy/realtime');
                const data = await response.json();
                updateUI(data);
            } catch (error) {
                console.error('Ø®Ø·Ø§:', error);
            }
        }
        
        async function fetchHistory() {
            try {
                const [signals, pumps] = await Promise.all([
                    fetch('/api/signals/history?limit=50').then(r => r.json()),
                    fetch('/api/pump-dump/history').then(r => r.json())
                ]);
                
                updateSignalHistory(signals);
                updatePumpDumpHistory(pumps);
            } catch (error) {
                console.error('Ø®Ø·Ø§:', error);
            }
        }
        
        async function fetchRankings() {
            try {
                const response = await fetch('/api/rankings');
                const data = await response.json();
                