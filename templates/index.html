<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸš€ Ø³ÛŒØ³ØªÙ… Ù…Ø¹Ø§Ù…Ù„Ø§Øª ÙÛŒÙˆÚ†Ø±Ø²</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.socket.io/4.5.4/socket.io.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/luxon@3.3.0/build/global/luxon.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-luxon@1.3.1/dist/chartjs-adapter-luxon.umd.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Vazirmatn:wght@400;700&display=swap" rel="stylesheet">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: 'Vazirmatn', sans-serif;
            background: linear-gradient(135deg, #0a0a1a 0%, #1a1a3e 100%);
            color: #fff;
            min-height: 100vh;
        }
        
        .container { max-width: 1800px; margin: 0 auto; padding: 20px; }
        
        /* Header */
        .header {
            background: rgba(255,255,255,0.05);
            border-radius: 20px;
            padding: 20px 30px;
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.1);
        }
        
        .logo {
            font-size: 28px;
            font-weight: bold;
            background: linear-gradient(90deg, #00ff88, #00bfff);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .status { display: flex; gap: 20px; align-items: center; }
        
        .status-item {
            padding: 10px 20px;
            border-radius: 12px;
            font-size: 14px;
        }
        
        .status-item.online { background: rgba(0,255,136,0.2); color: #00ff88; }
        .status-item.offline { background: rgba(255,68,68,0.2); color: #ff4444; }
        
        /* Navigation */
        .nav {
            margin-bottom: 20px;
            display: flex;
            gap: 10px;
        }
        
        .nav a {
            color: #fff;
            text-decoration: none;
            padding: 12px 25px;
            background: rgba(255,255,255,0.1);
            border-radius: 12px;
            transition: all 0.3s;
        }
        
        .nav a:hover { background: rgba(255,255,255,0.2); }
        .nav a.active { background: linear-gradient(90deg, #667eea, #764ba2); }
        
        /* Source Selector */
        .source-panel {
            background: rgba(255,255,255,0.05);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            border: 1px solid rgba(255,255,255,0.1);
        }
        
        .source-panel h3 { margin-bottom: 15px; font-size: 16px; }
        
        .source-buttons { display: flex; gap: 10px; flex-wrap: wrap; }
        
        .source-btn {
            background: rgba(255,255,255,0.1);
            border: 2px solid transparent;
            color: #fff;
            padding: 10px 20px;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
            font-family: inherit;
        }
        
        .source-btn:hover { background: rgba(255,255,255,0.2); }
        .source-btn.active { border-color: #00ff88; background: rgba(0,255,136,0.2); }
        
        /* Alerts Panel */
        .alerts-panel {
            background: linear-gradient(135deg, rgba(255,0,0,0.1), rgba(255,100,0,0.1));
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            border: 1px solid rgba(255,100,0,0.3);
        }
        
        .alerts-panel h3 { margin-bottom: 15px; color: #ffa500; }
        
        .alerts-scroll {
            display: flex;
            gap: 15px;
            overflow-x: auto;
            padding-bottom: 10px;
        }
        
        .alert-card {
            min-width: 250px;
            background: rgba(0,0,0,0.3);
            border-radius: 12px;
            padding: 15px;
            border-right: 4px solid #ff4444;
            animation: pulse 2s infinite;
        }
        
        .alert-card.pump { border-right-color: #00ff88; }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }
        
        .alert-card .symbol { font-size: 18px; font-weight: bold; }
        .alert-card .type { font-size: 24px; margin: 10px 0; }
        .alert-card .stats { font-size: 13px; color: #888; }
        
        /* Main Grid */
        .main-grid {
            display: grid;
            grid-template-columns: 1fr 380px;
            gap: 20px;
        }
        
        /* Data Grid */
        .data-panel {
            background: rgba(255,255,255,0.05);
            border-radius: 15px;
            overflow: hidden;
            border: 1px solid rgba(255,255,255,0.1);
        }
        
        .data-header {
            background: rgba(255,255,255,0.1);
            padding: 15px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .data-controls { display: flex; gap: 10px; }
        
        .data-controls input,
        .data-controls select {
            background: rgba(0,0,0,0.3);
            border: 1px solid rgba(255,255,255,0.2);
            color: #fff;
            padding: 8px 15px;
            border-radius: 8px;
            font-family: inherit;
        }
        
        .data-body {
            max-height: 500px;
            overflow-y: auto;
        }
        
        .data-row {
            display: grid;
            grid-template-columns: 50px 90px 100px 80px 70px 70px 70px 90px 80px;
            padding: 12px 20px;
            border-bottom: 1px solid rgba(255,255,255,0.05);
            align-items: center;
            cursor: pointer;
            transition: background 0.2s;
        }
        
        .data-row:hover { background: rgba(255,255,255,0.05); }
        .data-row:nth-child(even) { background: rgba(255,255,255,0.02); }
        .data-row:nth-child(even):hover { background: rgba(255,255,255,0.07); }
        
        .data-row.header {
            background: rgba(255,255,255,0.1);
            font-weight: bold;
            font-size: 13px;
            position: sticky;
            top: 0;
            cursor: default;
        }
        
        .positive { color: #00ff88; }
        .negative { color: #ff4444; }
        
        /* Signals Panel */
        .signals-panel {
            background: rgba(255,255,255,0.05);
            border-radius: 15px;
            padding: 20px;
            border: 1px solid rgba(255,255,255,0.1);
            max-height: 600px;
            overflow-y: auto;
        }
        
        .signals-panel h3 { margin-bottom: 15px; }
        
        .signal-card {
            background: rgba(255,255,255,0.05);
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 12px;
            border-right: 4px solid #3498db;
            transition: transform 0.2s;
        }
        
        .signal-card:hover { transform: translateX(-5px); }
        .signal-card.buy { border-right-color: #00ff88; }
        .signal-card.sell { border-right-color: #ff4444; }
        
        .signal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .signal-symbol { font-weight: bold; font-size: 16px; }
        
        .signal-strength {
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
        }
        
        .signal-type {
            font-size: 22px;
            margin-bottom: 8px;
        }
        
        .signal-reason {
            font-size: 12px;
            color: #888;
            line-height: 1.6;
        }
        
        .signal-price {
            margin-top: 10px;
            font-size: 14px;
        }
        
        /* Chart Container */
        .chart-panel {
            background: rgba(255,255,255,0.05);
            border-radius: 15px;
            padding: 20px;
            margin-top: 20px;
            border: 1px solid rgba(255,255,255,0.1);
        }
        
        .chart-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .chart-title { font-size: 18px; }
        
        .timeframe-buttons { display: flex; gap: 8px; }
        
        .tf-btn {
            background: rgba(255,255,255,0.1);
            border: none;
            color: #fff;
            padding: 8px 16px;
            border-radius: 8px;
            cursor: pointer;
            font-family: inherit;
            transition: all 0.2s;
        }
        
        .tf-btn:hover { background: rgba(255,255,255,0.2); }
        .tf-btn.active { background: #3498db; }
        
        .chart-container {
            position: relative;
            height: 400px;
        }
        
        .indicator-chart {
            height: 120px;
            margin-top: 20px;
        }
        
        .crossover-points {
            margin-top: 15px;
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }
        
        .cross-point {
            background: rgba(255,255,255,0.1);
            padding: 6px 12px;
            border-radius: 8px;
            font-size: 12px;
        }
        
        .cross-point.buy { background: rgba(0,255,136,0.2); }
        .cross-point.sell { background: rgba(255,68,68,0.2); }
        
        /* Accuracy Stats */
        .accuracy-panel {
            background: linear-gradient(135deg, rgba(102,126,234,0.2), rgba(118,75,162,0.2));
            border-radius: 15px;
            padding: 20px;
            margin-top: 20px;
            border: 1px solid rgba(102,126,234,0.3);
        }
        
        .accuracy-stats {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 15px;
            margin-top: 15px;
        }
        
        .accuracy-stat {
            text-align: center;
            padding: 15px;
            background: rgba(0,0,0,0.2);
            border-radius: 12px;
        }
        
        .accuracy-stat .value {
            font-size: 28px;
            font-weight: bold;
        }
        
        .accuracy-stat .label {
            font-size: 12px;
            color: #888;
            margin-top: 5px;
        }
        
        .accuracy-stat.success .value { color: #00ff88; }
        .accuracy-stat.failure .value { color: #ff4444; }
        
        /* Scrollbar */
        ::-webkit-scrollbar { width: 8px; height: 8px; }
        ::-webkit-scrollbar-track { background: rgba(255,255,255,0.05); }
        ::-webkit-scrollbar-thumb { background: rgba(255,255,255,0.2); border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: rgba(255,255,255,0.3); }
        
        /* Responsive */
        @media (max-width: 1400px) {
            .main-grid { grid-template-columns: 1fr; }
            .data-row { grid-template-columns: 40px 80px 90px 70px 60px 60px 60px 80px 70px; font-size: 13px; }
        }
        
        @media (max-width: 768px) {
            .header { flex-direction: column; gap: 15px; text-align: center; }
            .accuracy-stats { grid-template-columns: repeat(2, 1fr); }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <div class="logo">ğŸš€ Ø³ÛŒØ³ØªÙ… Ù…Ø¹Ø§Ù…Ù„Ø§Øª ÙÛŒÙˆÚ†Ø±Ø²</div>
            <div class="status">
                <div class="status-item" id="connectionStatus">ğŸ”´ Ø¯Ø± Ø­Ø§Ù„ Ø§ØªØµØ§Ù„...</div>
                <div class="status-item" id="lastUpdate">Ø¢Ø®Ø±ÛŒÙ† Ø¢Ù¾Ø¯ÛŒØª: -</div>
                <div class="status-item" id="coinCount">Ø§Ø±Ø²Ù‡Ø§: 0</div>
            </div>
        </div>
        
        <!-- Navigation -->
        <div class="nav">
            <a href="/" class="active">ğŸ  Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯</a>
            <a href="/analytics">ğŸ“Š Ø¢Ù…Ø§Ø± Ø¯Ù‚Øª</a>
        </div>
        
        <!-- Source Selector -->
        <div class="source-panel">
            <h3>ğŸŒ Ø§Ù†ØªØ®Ø§Ø¨ Ù…Ù†Ø¨Ø¹ Ø¯Ø§Ø¯Ù‡ (ØµØ±Ø§ÙÛŒâ€ŒÙ‡Ø§ÛŒ Ø¨Ø¯ÙˆÙ† ØªØ­Ø±ÛŒÙ…)</h3>
            <div class="source-buttons" id="sourceButtons">
                <button class="source-btn active" data-source="kucoin">ğŸŸ¢ Ú©ÙˆÚ©ÙˆÛŒÙ† (Ù¾ÛŒØ´Ù†Ù‡Ø§Ø¯ÛŒ)</button>
                <button class="source-btn" data-source="bybit">Ø¨Ø§ÛŒâ€ŒØ¨ÛŒØª</button>
                <button class="source-btn" data-source="okx">OKX</button>
                <button class="source-btn" data-source="mexc">MEXC</button>
                <button class="source-btn" data-source="gateio">Gate.io</button>
            </div>
        </div>
        
        <!-- Pump/Dump Alerts -->
        <div class="alerts-panel">
            <h3>ğŸš¨ Ù‡Ø´Ø¯Ø§Ø±Ù‡Ø§ÛŒ Ù¾Ø§Ù…Ù¾ Ùˆ Ø¯Ø§Ù…Ù¾ (Ø²Ù†Ø¯Ù‡)</h3>
            <div class="alerts-scroll" id="alertsContainer">
                <div style="color: #888; padding: 20px;">Ø¯Ø± Ø§Ù†ØªØ¸Ø§Ø± Ù‡Ø´Ø¯Ø§Ø±...</div>
            </div>
        </div>
        
        <!-- Main Content -->
        <div class="main-grid">
            <!-- Data Grid -->
            <div>
                <div class="data-panel">
                    <div class="data-header">
                        <h3>ğŸ“Š 250 Ø§Ø±Ø² Ø¨Ø±ØªØ± ÙÛŒÙˆÚ†Ø±Ø²</h3>
                        <div class="data-controls">
                            <input type="text" id="searchInput" placeholder="ğŸ” Ø¬Ø³ØªØ¬Ùˆ...">
                            <select id="sortSelect">
                                <option value="volume">Ù…Ø±ØªØ¨â€ŒØ³Ø§Ø²ÛŒ: Ø­Ø¬Ù…</option>
                                <option value="change">Ù…Ø±ØªØ¨â€ŒØ³Ø§Ø²ÛŒ: ØªØºÛŒÛŒØ±Ø§Øª</option>
                                <option value="price">Ù…Ø±ØªØ¨â€ŒØ³Ø§Ø²ÛŒ: Ù‚ÛŒÙ…Øª</option>
                                <option value="name">Ù…Ø±ØªØ¨â€ŒØ³Ø§Ø²ÛŒ: Ù†Ø§Ù…</option>
                            </select>
                        </div>
                    </div>
                    <div class="data-body">
                        <div class="data-row header">
                            <div>#</div>
                            <div>Ù†Ù…Ø§Ø¯</div>
                            <div>Ù‚ÛŒÙ…Øª</div>
                            <div>ØªØºÛŒÛŒØ±%</div>
                            <div>RSI</div>
                            <div>MA7</div>
                            <div>EMA7</div>
                            <div>Ø­Ø¬Ù…</div>
                            <div>Ø³ÛŒÚ¯Ù†Ø§Ù„</div>
                        </div>
                        <div id="priceGrid"></div>
                    </div>
                </div>
                
                <!-- Chart -->
                <div class="chart-panel">
                    <div class="chart-header">
                        <h3 class="chart-title">ğŸ“ˆ Ú†Ø§Ø±Øª: <span id="chartSymbol">BTC/USDT</span></h3>
                        <div class="timeframe-buttons">
                            <button class="tf-btn active" data-tf="1m">1m</button>
                            <button class="tf-btn" data-tf="5m">5m</button>
                            <button class="tf-btn" data-tf="15m">15m</button>
                            <button class="tf-btn" data-tf="1h">1h</button>
                            <button class="tf-btn" data-tf="4h">4h</button>
                        </div>
                    </div>
                    <div class="chart-container">
                        <canvas id="mainChart"></canvas>
                    </div>
                    <div class="indicator-chart">
                        <canvas id="rsiChart"></canvas>
                    </div>
                    <div class="crossover-points" id="crossoverPoints"></div>
                </div>
                
                <!-- Accuracy Stats -->
                <div class="accuracy-panel">
                    <h3>ğŸ“ˆ Ø¢Ù…Ø§Ø± Ø¯Ù‚Øª Ø³ÛŒÚ¯Ù†Ø§Ù„â€ŒÙ‡Ø§ (24 Ø³Ø§Ø¹Øª Ø§Ø®ÛŒØ±)</h3>
                    <div class="accuracy-stats">
                        <div class="accuracy-stat success">
                            <div class="value" id="successRate">0%</div>
                            <div class="label">Ù†Ø±Ø® Ù…ÙˆÙÙ‚ÛŒØª</div>
                        </div>
                        <div class="accuracy-stat">
                            <div class="value" id="totalSignals">0</div>
                            <div class="label">Ú©Ù„ Ø³ÛŒÚ¯Ù†Ø§Ù„â€ŒÙ‡Ø§</div>
                        </div>
                        <div class="accuracy-stat success">
                            <div class="value" id="successCount">0</div>
                            <div class="label">Ù…ÙˆÙÙ‚</div>
                        </div>
                        <div class="accuracy-stat failure">
                            <div class="value" id="failCount">0</div>
                            <div class="label">Ù†Ø§Ù…ÙˆÙÙ‚</div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Signals Panel -->
            <div class="signals-panel">
                <h3>ğŸ“¡ Ø³ÛŒÚ¯Ù†Ø§Ù„â€ŒÙ‡Ø§ÛŒ Ù…Ø¹Ø§Ù…Ù„Ø§ØªÛŒ (Ø²Ù†Ø¯Ù‡)</h3>
                <div id="signalsContainer">
                    <div style="color: #888; text-align: center; padding: 30px;">
                        Ø¯Ø± Ø­Ø§Ù„ ØªØ­Ù„ÛŒÙ„ Ø¨Ø§Ø²Ø§Ø±...
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // Ù…ØªØºÛŒØ±Ù‡Ø§ÛŒ Ú¯Ù„ÙˆØ¨Ø§Ù„
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        const socket = io();
        let allPrices = [];
        let mainChart = null;
        let rsiChart = null;
        let currentSymbol = 'BTCUSDT';
        let currentTimeframe = '1m';
        
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // Ø±ÙˆÛŒØ¯Ø§Ø¯Ù‡Ø§ÛŒ Ø³ÙˆÚ©Øª
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        socket.on('connect', () => {
            document.getElementById('connectionStatus').className = 'status-item online';
            document.getElementById('connectionStatus').innerHTML = 'ğŸŸ¢ Ù…ØªØµÙ„';
        });
        
        socket.on('disconnect', () => {
            document.getElementById('connectionStatus').className = 'status-item offline';
            document.getElementById('connectionStatus').innerHTML = 'ğŸ”´ Ù‚Ø·Ø¹ Ø´Ø¯Ù‡';
        });
        
        socket.on('prices_update', (data) => {
            allPrices = data.prices || [];
            updatePriceGrid();
            document.getElementById('lastUpdate').textContent = 
                'Ø¢Ø®Ø±ÛŒÙ† Ø¢Ù¾Ø¯ÛŒØª: ' + new Date().toLocaleTimeString('fa-IR');
            document.getElementById('coinCount').textContent = 
                'Ø§Ø±Ø²Ù‡Ø§: ' + allPrices.length;
        });
        
        socket.on('signals_update', (data) => {
            updateSignals(data.signals || []);
            updateAlerts(data.pump_dump || []);
        });
        
        socket.on('validation_update', (data) => {
            if (data.stats && data.stats.last_24h) {
                updateAccuracyStats(data.stats.last_24h);
            }
        });
        
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // Ø¢Ù¾Ø¯ÛŒØª Ú¯Ø±ÛŒØ¯ Ù‚ÛŒÙ…Øªâ€ŒÙ‡Ø§
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        function updatePriceGrid() {
            const container = document.getElementById('priceGrid');
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            const sortBy = document.getElementById('sortSelect').value;
            
            let filtered = allPrices.filter(p => 
                p.symbol.toLowerCase().includes(searchTerm)
            );
            
            // Ù…Ø±ØªØ¨â€ŒØ³Ø§Ø²ÛŒ
            switch(sortBy) {
                case 'volume':
                    filtered.sort((a, b) => (b.quote_volume || 0) - (a.quote_volume || 0));
                    break;
                case 'change':
                    filtered.sort((a, b) => 
                        Math.abs(b.price_change_percent || 0) - Math.abs(a.price_change_percent || 0)
                    );
                    break;
                case 'price':
                    filtered.sort((a, b) => (b.price || 0) - (a.price || 0));
                    break;
                case 'name':
                    filtered.sort((a, b) => a.symbol.localeCompare(b.symbol));
                    break;
            }
            
            container.innerHTML = filtered.slice(0, 250).map((p, i) => {
                const changeClass = (p.price_change_percent || 0) >= 0 ? 'positive' : 'negative';
                const changeSign = (p.price_change_percent || 0) >= 0 ? '+' : '';
                
                return `
                    <div class="data-row" onclick="loadChart('${p.symbol}')">
                        <div>${i + 1}</div>
                        <div><strong>${p.symbol}</strong></div>
                        <div>$${formatNumber(p.price)}</div>
                        <div class="${changeClass}">${changeSign}${(p.price_change_percent || 0).toFixed(2)}%</div>
                        <div>-</div>
                        <div>-</div>
                        <div>-</div>
                        <div>${formatVolume(p.quote_volume)}</div>
                        <div>-</div>
                    </div>
                `;
            }).join('');
        }
        
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // Ø¢Ù¾Ø¯ÛŒØª Ø³ÛŒÚ¯Ù†Ø§Ù„â€ŒÙ‡Ø§
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        function updateSignals(signals) {
            const container = document.getElementById('signalsContainer');
            
            if (!signals || signals.length === 0) {
                container.innerHTML = `
                    <div style="color: #888; text-align: center; padding: 30px;">
                        Ø³ÛŒÚ¯Ù†Ø§Ù„ÛŒ ÛŒØ§ÙØª Ù†Ø´Ø¯
                    </div>
                `;
                return;
            }
            
            // Ù…Ø±ØªØ¨â€ŒØ³Ø§Ø²ÛŒ Ø¨Ø± Ø§Ø³Ø§Ø³ Ù‚Ø¯Ø±Øª
            signals.sort((a, b) => (b.strength || 0) - (a.strength || 0));
            
            container.innerHTML = signals.slice(0, 20).map(s => {
                const cardClass = s.signal_type === 'BUY' ? 'buy' : 'sell';
                const typeEmoji = s.signal_type === 'BUY' ? 'ğŸŸ¢ Ø®Ø±ÛŒØ¯' : 'ğŸ”´ ÙØ±ÙˆØ´';
                const strengthColor = s.strength >= 70 ? '#00ff88' : 
                                     s.strength >= 50 ? '#ffa500' : '#ff4444';
                
                return `
                    <div class="signal-card ${cardClass}" onclick="loadChart('${s.symbol}')">
                        <div class="signal-header">
                            <span class="signal-symbol">${s.symbol}</span>
                            <span class="signal-strength" style="background: ${strengthColor}">${s.strength}%</span>
                        </div>
                        <div class="signal-type">${typeEmoji}</div>
                        <div class="signal-reason">${s.reason || ''}</div>
                        <div class="signal-price">ğŸ’° Ù‚ÛŒÙ…Øª: $${formatNumber(s.price)}</div>
                    </div>
                `;
            }).join('');
        }
        
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // Ø¢Ù¾Ø¯ÛŒØª Ù‡Ø´Ø¯Ø§Ø±Ù‡Ø§
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        function updateAlerts(alerts) {
            const container = document.getElementById('alertsContainer');
            
            if (!alerts || alerts.length === 0) {
                container.innerHTML = `
                    <div style="color: #888; padding: 20px;">Ø¯Ø± Ø§Ù†ØªØ¸Ø§Ø± Ù‡Ø´Ø¯Ø§Ø±...</div>
                `;
                return;
            }
            
            container.innerHTML = alerts.map(a => {
                const cardClass = a.alert_type === 'PUMP' ? 'pump' : '';
                const emoji = a.alert_type === 'PUMP' ? 'ğŸš€' : 'ğŸ“‰';
                const changeClass = a.price_change >= 0 ? 'positive' : 'negative';
                
                return `
                    <div class="alert-card ${cardClass}" onclick="loadChart('${a.symbol}')">
                        <div class="symbol">${a.symbol}</div>
                        <div class="type">${emoji} ${a.alert_type}</div>
                        <div class="stats">
                            ØªØºÛŒÛŒØ± Ù‚ÛŒÙ…Øª: <span class="${changeClass}">${a.price_change}%</span><br>
                            ØªØºÛŒÛŒØ± Ø­Ø¬Ù…: ${a.volume_change}%<br>
                            Ø¯Ø± ${a.time_period} Ú¯Ø°Ø´ØªÙ‡
                        </div>
                    </div>
                `;
            }).join('');
        }
        
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // Ø¢Ù¾Ø¯ÛŒØª Ø¢Ù…Ø§Ø± Ø¯Ù‚Øª
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        function updateAccuracyStats(stats) {
            document.getElementById('successRate').textContent = (stats.success_rate || 0) + '%';
            document.getElementById('totalSignals').textContent = stats.total_signals || 0;
            document.getElementById('successCount').textContent = stats.successful || 0;
            document.getElementById('failCount').textContent = stats.failed || 0;
        }
        
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // Ù„ÙˆØ¯ Ú†Ø§Ø±Øª
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        async function loadChart(symbol) {
            currentSymbol = symbol;
            document.getElementById('chartSymbol').textContent = symbol;
            
            try {
                const response = await fetch(`/api/chart/${symbol}?timeframe=${currentTimeframe}`);
                const data = await response.json();
                
                if (data.error) {
                    console.error(data.error);
                    return;
                }
                
                renderMainChart(data);
                renderRsiChart(data);
                renderCrossovers(data);
                
            } catch (error) {
                console.error('Ø®Ø·Ø§ Ø¯Ø± Ù„ÙˆØ¯ Ú†Ø§Ø±Øª:', error);
            }
        }
        
        function renderMainChart(data) {
            const ctx = document.getElementById('mainChart').getContext('2d');
            
            if (mainChart) mainChart.destroy();
            
            const candles = data.candles || [];
            const labels = candles.map(c => new Date(c.timestamp));
            const prices = candles.map(c => c.close);
            
            mainChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [
                        {
                            label: 'Ù‚ÛŒÙ…Øª',
                            data: prices,
                            borderColor: '#3498db',
                            borderWidth: 2,
                            fill: false,
                            pointRadius: 0,
                            tension: 0.1
                        },
                        {
                            label: 'MA 7',
                            data: data.indicators?.ma_7 || [],
                            borderColor: '#e74c3c',
                            borderWidth: 1,
                            fill: false,
                            pointRadius: 0
                        },
                        {
                            label: 'MA 25',
                            data: data.indicators?.ma_25 || [],
                            borderColor: '#f1c40f',
                            borderWidth: 1,
                            fill: false,
                            pointRadius: 0
                        },
                        {
                            label: 'EMA 7',
                            data: data.indicators?.ema_7 || [],
                            borderColor: '#9b59b6',
                            borderWidth: 1,
                            borderDash: [5, 5],
                            fill: false,
                            pointRadius: 0
                        },
                        {
                            label: 'UT Bot Stop',
                            data: data.indicators?.atr_stop || [],
                            borderColor: '#00ff88',
                            borderWidth: 2,
                            fill: false,
                            pointRadius: 0
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    interaction: { intersect: false, mode: 'index' },
                    plugins: {
                        legend: { 
                            labels: { color: '#fff', font: { size: 11 } },
                            position: 'top'
                        }
                    },
                    scales: {
                        x: {
                            type: 'time',
                            ticks: { color: '#888', maxTicksLimit: 10 },
                            grid: { color: 'rgba(255,255,255,0.05)' }
                        },
                        y: {
                            ticks: { color: '#888' },
                            grid: { color: 'rgba(255,255,255,0.05)' }
                        }
                    }
                }
            });
        }
        
        function renderRsiChart(data) {
            const ctx = document.getElementById('rsiChart').getContext('2d');
            
            if (rsiChart) rsiChart.destroy();
            
            const candles = data.candles || [];
            const labels = candles.map(c => new Date(c.timestamp));
            
            rsiChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'RSI',
                        data: data.indicators?.rsi || [],
                        borderColor: '#e74c3c',
                        borderWidth: 2,
                        fill: false,
                        pointRadius: 0
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: false }
                    },
                    scales: {
                        x: { display: false },
                        y: {
                            min: 0,
                            max: 100,
                            ticks: { color: '#888' },
                            grid: { color: 'rgba(255,255,255,0.05)' }
                        }
                    }
                }
            });
        }
        
        function renderCrossovers(data) {
            const container = document.getElementById('crossoverPoints');
            const allCrosses = [
                ...(data.crossovers?.ma || []),
                ...(data.crossovers?.ema || [])
            ].slice(-10);
            
            if (allCrosses.length === 0) {
                container.innerHTML = '<span style="color:#888">Ù†Ù‚Ø·Ù‡ ØªÙ„Ø§Ù‚ÛŒ ÛŒØ§ÙØª Ù†Ø´Ø¯</span>';
                return;
            }
            
            container.innerHTML = allCrosses.map(c => {
                const crossClass = c.signal.includes('BUY') ? 'buy' : 'sell';
                const emoji = c.signal.includes('BUY') ? 'ğŸŸ¢' : 'ğŸ”´';
                return `<span class="cross-point ${crossClass}">${emoji} ${c.type} @ $${formatNumber(c.price)}</span>`;
            }).join('');
        }
        
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // ØªØºÛŒÛŒØ± Ù…Ù†Ø¨Ø¹
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        document.getElementById('sourceButtons').addEventListener('click', async (e) => {
            if (e.target.classList.contains('source-btn')) {
                const source = e.target.dataset.source;
                
                document.querySelectorAll('.source-btn').forEach(b => b.classList.remove('active'));
                e.target.classList.add('active');
                
                try {
                    const response = await fetch(`/api/switch-source/${source}`);
                    const result = await response.json();
                    
                    if (result.success) {
                        socket.emit('request_update');
                    }
                } catch (error) {
                    console.error('Ø®Ø·Ø§:', error);
                }
            }
        });
        
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // ØªØºÛŒÛŒØ± ØªØ§ÛŒÙ…â€ŒÙØ±ÛŒÙ…
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        document.querySelector('.timeframe-buttons').addEventListener('click', (e) => {
            if (e.target.classList.contains('tf-btn')) {
                document.querySelectorAll('.tf-btn').forEach(b => b.classList.remove('active'));
                e.target.classList.add('active');
                currentTimeframe = e.target.dataset.tf;
                loadChart(currentSymbol);
            }
        });
        
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // Ø±ÙˆÛŒØ¯Ø§Ø¯Ù‡Ø§ÛŒ ÙÛŒÙ„ØªØ±
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        document.getElementById('searchInput').addEventListener('input', updatePriceGrid);
        document.getElementById('sortSelect').addEventListener('change', updatePriceGrid);
        
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // ØªÙˆØ§Ø¨Ø¹ Ú©Ù…Ú©ÛŒ
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        function formatNumber(num) {
            if (!num || isNaN(num)) return '0';
            num = parseFloat(num);
            if (num >= 1000) return num.toLocaleString('en-US', {maximumFractionDigits: 2});
            if (num >= 1) return num.toFixed(2);
            if (num >= 0.0001) return num.toFixed(6);
            return num.toExponential(4);
        }
        
        function formatVolume(vol) {
            if (!vol || isNaN(vol)) return '0';
            vol = parseFloat(vol);
            if (vol >= 1e9) return (vol / 1e9).toFixed(2) + 'B';
            if (vol >= 1e6) return (vol / 1e6).toFixed(2) + 'M';
            if (vol >= 1e3) return (vol / 1e3).toFixed(2) + 'K';
            return vol.toFixed(2);
        }
        
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // Ù„ÙˆØ¯ Ø§ÙˆÙ„ÛŒÙ‡
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        async function init() {
            try {
                // Ø¯Ø±ÛŒØ§ÙØª Ù‚ÛŒÙ…Øªâ€ŒÙ‡Ø§
                const pricesRes = await fetch('/api/prices');
                allPrices = await pricesRes.json();
                updatePriceGrid();
                
                // Ø¯Ø±ÛŒØ§ÙØª Ø¢Ù…Ø§Ø± Ø¯Ù‚Øª
                const accuracyRes = await fetch('/api/accuracy?hours=24');
                const accuracyData = await accuracyRes.json();
                updateAccuracyStats(accuracyData);
                
                // Ù„ÙˆØ¯ Ú†Ø§Ø±Øª Ø§ÙˆÙ„
                loadChart('BTCUSDT');
                
            } catch (error) {
                console.error('Ø®Ø·Ø§ Ø¯Ø± Ù„ÙˆØ¯ Ø§ÙˆÙ„ÛŒÙ‡:', error);
            }
        }
        
        init();
    </script>
</body>
</html>